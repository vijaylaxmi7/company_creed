<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
  <title>{% block title %}Company Creed{% endblock %}</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  {% load static %}
  <link rel="stylesheet" href="{% static 'css/home.css'%}">
  <script src="{% static 'users/js/index.js' %}"></script>

  <style>
  </style>

</head>

<body>
  {% if user.employee.is_authenticated %}
  <div id="sidenav" class="sidenav">
    <div class="logo">
      <img src="{% static '/images/logo.jpg' %}" alt="Company Logo">
    </div>
  
    <a href="http://127.0.0.1:8000/index/" onmouseenter="dashboardFunction()">
      <span class="glyphicon glyphicon-dashboard"></span> Dashboard
    </a>
    <a onmouseenter="attendanceFunction()">
      <span class="glyphicon glyphicon-check"></span> Attendance
    </a>
    <div id="myDropdown" class="dropdown-content">
      <a href="#">Apply Leaves</a>
      <a href="#">My Leaves</a>
      {% if request.user.employee.is_manager %}
      <a href="{% url 'check-in-out' %}">Check-in/ Check-out</a>
      {%endif%}
    </div>


    <a onmouseenter="taskFunction()">
      <span class="glyphicon glyphicon-tasks"></span> Task/Call
    </a>
    {% if request.user.employee.is_manager %}
    <div id="taskDropdown" class="dropdown-content">
      <a href="#">Assign calls</a>
      <a href="{% url 'task-assignment' %}">Assign tasks</a>
      <a href="{% url 'view-task' %}">View assigned Task</a>
      <a href="{% url 'my-task' %}">View tasks</a>
      <a href="{%url 'task-status'%}">Send Task Status</a>
    </div>
    {% else %}
    <div id="taskDropdown" class="dropdown-content">
      <a href="{% url 'my-task' %}">View tasks</a>
    </div>
    {% endif %}


    <a onmouseenter="leaveFunction()">
      <span class="glyphicon glyphicon-tasks"></span> Manage Leave
    </a>
    {% if request.user.employee.is_manager %}
    <div id="leaveDropdown" class="dropdown-content">
      <a href="{% url 'leave-application' %}">Apply Leaves</a>
      <a href="{% url 'my-leave' %}">My Leaves</a>
      <a href="{% url 'leave-balance' %}">Leave Balance</a>
      <a href="{% url 'leave-manage' %}">Manage leave applications</a>
    </div>
    {% else %}
    <div id="leaveDropdown" class="dropdown-content">
      <a href="{% url 'leave-application' %}">Apply Leaves</a>
      <a href="{% url 'my-leave' %}">My Leaves</a>
      <a href="{% url 'leave-balance' %}">Leave Balance</a>
    </div>
    {% endif %}

    <a href="/logout/" onmouseenter="dashboardFunction()">
      <span class="glyphicon glyphicon-log-in"></span> Logout
    </a>

  </div>

  <div id="main">
    <nav class="navbar navbar-inverse">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
          <ul class="nav navbar-nav">
  
            <li>
              <form class="navbar-form" role="search">
                <div class="input-group">
                  <input type="text" class="form-control" placeholder="Search" name="q">
                  <div class="input-group-btn">
                    <button class="btn btn-default" type="submit">
                      <i class="glyphicon glyphicon-search"></i>
                    </button>
                  </div>
                </div>
              </form>
            </li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <div class="dropdown">
                <button onmouseenter="profileFunction()" class="dropbtn" style="
                border-radius: 25px;
                height: 41px;
                padding: 0px 0px;
                position: relative;
                bottom: 1px;
            ">
                {% comment %} <div class="user-circle">{{ request.user.employee.first_name|first|upper }}{{ request.user.employee.last_name|first|upper }}</div> {% endcomment %}
                <div class="user-circle"><img  style = "
                  max-height: 44px; max-width:44px; border-radius: 25px;" src = "{{request.user.employee.profile_pic.url}}"></div>
                <span class="glyphicon glyphicon-triangle-bottom"></span>
                </button>
                <div id="myDropdown1" class="dropdown-content" style="
                top: 62px;
                right: -11px;
            ">
            {% comment %} <center><div class="user-circle"><img  style = " {% endcomment %}
              {% comment %} max-height: 60px; border-radius: 25px;" src = "{{request.user.employee.profile_pic.url}}"></div></center> {% endcomment %}
                    <a href="{% url 'edit-profile' request.user.employee.id %}">Edit Profile</a>
                    <li><a href="/password_reset/"><span class=""></span>Reset password</a></li>
                    <li><a href="/logout/"><span class="glyphicon glyphicon-log-in"></span> Logout</a></li>
                </div>
            </div>
        </ul>
        </div>
      </div>
    </nav>

    {% block welcome %}
    <div id="timestamp" class="timestamp-container">
      <p class="timestamp-text">{{ current_datetime }}</p>
  
      <p class="welcome-text">{{ greeting }}, {{ request.user.employee.first_name }} {{ request.user.employee.last_name }}</p>
  
      <div class="check-in-out">
        <button id="checkInOutButton" class="btn btn-primary" onclick="toggleCheckInOut()" data-action="check-in">Check In</button>
    </div>
    {% endblock welcome %}

    {% block content %}
    {% endblock content %}

    {% block edit %}
    {% endblock edit %}
    
    {% block task %}
    {% endblock task %}



    
  </div>

<script>

    function attendanceFunction() {
      document.getElementById("myDropdown").classList.toggle("show");
    }
    window.onclick = function (event) {
      if (!event.target.matches('.dropbtn')) {
        var dropdowns = document.getElementsByClassName("dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    }


    function profileFunction() {
      document.getElementById("myDropdown1").classList.toggle("show");
    }
    window.onclick = function (event) {
      if (!event.target.matches('.dropbtn')) {
        var dropdowns = document.getElementsByClassName("dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    }


    function taskFunction() {
      document.getElementById("taskDropdown").classList.toggle("show");
    }
    window.onclick = function (event) {
      if (!event.target.matches('.dropbtn')) {
        var dropdowns = document.getElementsByClassName("dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    }


    function leaveFunction() {
      document.getElementById("leaveDropdown").classList.toggle("show");
    }
    window.onclick = function (event) {
      if (!event.target.matches('.dropbtn')) {
        var dropdowns = document.getElementsByClassName("dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    }


  document.addEventListener('DOMContentLoaded', function () {
    const button = document.getElementById('checkInOutButton');
    const storedState = localStorage.getItem('checkInOutState');

    if (storedState === 'check-out') {
        button.textContent = 'Check Out';
        button.dataset.action = 'check-out';
    } else {
        button.textContent = 'Check In';
        button.dataset.action = 'check-in';
    }
  });

  function toggleCheckInOut() {
    const button = document.getElementById('checkInOutButton');
    const action = button.dataset.action;
    const url = action === 'check-in' ? "{% url 'check-in' %}" : "{% url 'check-out' %}";

    fetch(url)
        .then(response => response.text())
        .then(data => {
            console.log(data);
            if (action === 'check-in') {
                button.textContent = 'Check Out';
                button.dataset.action = 'check-out';
            } else {
                button.textContent = 'Check In';
                button.dataset.action = 'check-in';
            }
            localStorage.setItem('checkInOutState', button.dataset.action);
        });
  }

</script>
  
  {%else%}

  {% block signin %}
  {% endblock signin %}
  
  {%endif%}

</body>
</html>